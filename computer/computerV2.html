<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	  "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>4-bit computer</title>

      <script>
       // Settings that control the architecture.
       var ADDR_LEN = 4;
       var INSTR_LEN = 4;
       var WORD_LEN = ADDR_LEN + INSTR_LEN;  
       var RAM_LEN = Math.pow(2,ADDR_LEN);
       var VIS_RAM_LEN = 16;   // Visible RAM 
      </script>

    <script src="./converters.js"></script>
    <script src="./hardware.js"></script>
    <script src="./ui.js"></script>
    <script src="./assembler.js"></script>
    <script src="./loader.js"></script>

    <script src="./edx-jsinput.js"></script>  <!-- For edX -->
    <script src="/static/js/capa/src/jschannel.js"></script>    <!-- For edX -->

    <!-- jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <!-- Tipped  See http://www.tippedjs.com/  and http://www.tippedjs.com/license -->
    <script type="text/javascript" src="./tipped.js"></script>
    <link rel="stylesheet" type="text/css" href="./tipped.css" />
    <style>
    body {
       font-family:"Times";
    }
    </style>

    <script type='text/javascript'>
    <!--  This is the Tipped Script. Handles the hover hints -->
    <!--  See http://www.tippedjs.com/  and http://www.tippedjs.com/license -->

    $(document).ready(function() {
      Tipped.create('.boxes .box');
    });
    </script>
    <script type="text/javascript">
     $(document).ready(function() {
      Tipped.create('.data', function(element) {
        var addr = $(element).data('id');
        return "Data: " + ram[addr] ;
      }, {
       cache: false
      });
     });

     $(document).ready(function() {
      Tipped.create('.instr', function(element) {
        var addr = $(element).data('id');
        return "Instruction: " + displayMnemonic(ram[addr]) ;
      }, {
       cache: false
      });
     });

     $(document).ready(function() {
      Tipped.create('#pctr', function() {
        return "Program Counter: " + pcounter ;
      }, {
       cache: false
      });
     });

     $(document).ready(function() {
      Tipped.create('#preg', function() {
        return "Program Register: " + displayMnemonic(pregister);
      }, {
       cache: false
      });
     });

     $(document).ready(function() {
      Tipped.create('#rega', function() {
        return "RegisterA: " + registerA ;
      }, {
       cache: false
      });
     });
    </script>
    <script Language="JavaScript">
      
      // Mnemonics used in hover hints
      var op = ["NOP", "GET", "PUT", "ADD", "SUB", "MUL", "DIV", "UND","PRN", "INP", "UND","UND","UND","UND","UND","UND"];

      // Parse a assembly language instruction given its decimal value
      function displayMnemonic(n) {
	var str = pad(decToBinary(n), WORD_LEN);
	var instr = binaryToDecimal(str.substring(0,INSTR_LEN));
	var addr = str.substring(INSTR_LEN);
	return op[instr] + " " + addr;
      }

   </script>
  </head>
  <body onload='uiInit()'>
    <table width="550" align="center" border="1" frame="box" rules="none">  <!-- Main Container -->
      <tr>
	<td>
	  <img src="./android_CSP-128px.jpg">
	</td>
	<td>
	  <h1>4-Bit Computer Simulator</h1>
	</td>
      </tr>
      <tr>
	<td colspan="2">
	  <TABLE ALIGN="CENTER" BGCOLOR="#AAAAAA" BORDER="1" CELLPADDING="5">  <!-- Computer table -->
	    <TR>
	      <TD>
		<CENTER>
		  <div id="userinterface">
                    <table border="0">
                      <tr>
                        <td>
                          <table><tr><td>
   			      <font color="red">Monitor</font><br />
			      <textarea id="monitor" rows="10" col="15" readonly></textarea>
                            </td><td>
			      <font color="red">Editor</font><br />
                              <textarea id="editor" rows="10" col="30"></textarea>
                              <textarea id="machinecode" rows="10" col="10" style="visibility:hidden" readonly></textarea>
                            </td><td>
                              <button type="button" id="assemble" onclick="assembleProgram()">Assemble</button><br />
                              <button type="button" id="load" onclick="loadProgram()" disabled>Load</button>
                            </td>
                          </tr>
                          </table>       
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <font color="red">Keyboard</font><br />
 			  <input id="keyboard" type="text" maxlenvth="40" size="40" disabled></input>
                        </td>
                      </tr>
                    </table>
		  </div>
		</CENTER>
	      </TD>
	    </TR>

	    <tr>
	      <td>
               <div class='boxes position'>  <!-- start of boxes for tipped -->
		<table border="1">  <!-- RAM and CPU table -->
		  <tr>
		    <td>
		      <div id="ram" style="visibility:visible">
			<font color="red">RAM</font><br />
                        <table><tr><td><u>INST</u></td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                            <td><u>DATA</u></td><td>&nbsp;</td></tr></table>

                        <table><tr><td>0000:</td><td><span class='instr' data-id="0"><input onkeyup="uiHandleRamDisplay(this,event)" id="m0000" type="text" size="8" value="00000000" maxlength="8"></span></td>
                            <td>1000:</td><td><span class='data' data-id="8"><input id="m1000"  onkeyup="uiHandleRamDisplay(this,event)" type="text" size="8" value="00000000" maxlength="8"></span></td></tr>
                        </table>

                        <table><tr><td>0001:</td><td><span class='instr' data-id="1"><input id="m0001"  onkeyup="uiHandleRamDisplay(this,event)" type="text" size="8" value="00000000" maxlength="8"></span></td>
                            <td>1001:</td><td><span class='data' data-id="9"><input id="m1001"  onkeyup="uiHandleRamDisplay(this,event)" type="text" size="8" value="00000000" maxlength="8"></span></td></tr>
                        </table>
                        <table><tr><td>0010:</td><td><span class='instr' data-id="2"><input id="m0010"  onkeyup="uiHandleRamDisplay(this,event)" type="text" size="8" value="00000000" maxlength="8" ></span></td>
                            <td>1010:</td><td><span class='data' data-id="10"><input id="m1010"  onkeyup="uiHandleRamDisplay(this,event)" type="text" size="8" value="00000000" maxlength="8" ></span></td></tr>
                        </table>
                        <table><tr><td>0011:</td><td><span class='instr' data-id="3"><input id="m0011"  onkeyup="uiHandleRamDisplay(this,event)" type="text" size="8" value="00000000" maxlength="8" ></span></td>
                            <td>1011:</td><td><span class='data' data-id="11"><input id="m1011"  onkeyup="uiHandleRamDisplay(this,event)" type="text" size="8" value="00000000" maxlength="8" ></span></td></tr>
                        </table>
                        <table><tr><td>0100:</td><td><span class='instr' data-id="4"><input id="m0100"  onkeyup="uiHandleRamDisplay(this,event)" type="text" size="8" value="00000000" maxlength="8" ></span></td>
                            <td>1100:</td><td><span class='data' data-id="12"><input id="m1100"  onkeyup="uiHandleRamDisplay(this,event)" type="text" size="8" value="00000000" maxlength="8" ></span></td></tr>
                        </table>
                        <table><tr><td>0101:</td><td><span class='instr' data-id="5"><input id="m0101"  onkeyup="uiHandleRamDisplay(this,event)" type="text" size="8" value="00000000" maxlength="8" ></span></td>
                            <td>1101:</td><td><span class='data' data-id="13"><input id="m1101" onkeyup="uiHandleRamDisplay(this,event)"  type="text" size="8" value="00000000" maxlength="8" ></span></td></tr>
                        </table>
                        <table><tr><td>0110:</td><td><span class='instr' data-id="6"><input id="m0110"  onkeyup="uiHandleRamDisplay(this,event)" type="text" size="8" value="00000000" maxlength="8" ></span></td>
                            <td>1110:</td><td><span class='data' data-id="14"><input id="m1110"  onkeyup="uiHandleRamDisplay(this,event)" type="text" size="8" value="00000000" maxlength="8" ></span></td></tr>
                        </table>
                        <table><tr><td>0111:</td><td><span class='instr' data-id="7"><input id="m0111"  onkeyup="uiHandleRamDisplay(this,event)" type="text" size="8" value="00000000" maxlength="8" ></span></td>
                            <td>1111:</td><td><span class='data' data-id="15"><input id="m1111"  onkeyup="uiHandleRamDisplay(this,event)" type="text" size="8" value="00000000" maxlength="8" ></span></td></tr>
                        </table>
                        <br /><br />
		      </div>
		    </td>
		    <td>
                      <font color="red">CPU</font><br />
		      <div id="cpu" style="visibility:visible">
                        <table><tr><td><u>PCTR:</u>&nbsp;</td><td><input id="pctr" type="text" size="4" value="0000" maxlength="4" readonly></td>
                            <td><u>PREG:</u></td><td><input id="preg" type="text" size="8"  value="00000000" maxlength="8" readonly></td></tr></table>
                        <table><tr><td><u>REGA:</u></td><td><input id="rega" type="text" size="8"  value="00000000" maxlength="8" readonly></td>
                            <td>
<!-- Should we have a REGB? -->
<!--                              <u>REGB:</u></td><td> -->
<!--                              <div class="input"> -->
<!--                                <input id="regb" type="text" size="8" value="00000000" maxlength="8" readonly /> -->
<!--                                <span class="tooltip">Info</span> -->
<!--                              <div> -->
                            </td></tr></table>

                        <font size="2">
                        <br /><u>Instruction Set</u>
                        <br />&nbsp;&nbsp;&lt;x&gt; is a 4-bit memory address
                        <br />&nbsp;&nbsp;0000 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -- NOP (Do nothing)
                        <br />&nbsp;&nbsp;0001 &lt;x&gt; -- GET value at &lt;x&gt; and put in REGA
                        <br />&nbsp;&nbsp;0010 &lt;x&gt; -- PUT value in REGA at  &lt;x&gt;
                        <br />&nbsp;&nbsp;0011 &lt;x&gt; -- ADD value at &lt;x&gt; to REGA
                        <br />&nbsp;&nbsp;0100 &lt;x&gt; -- SUB value at  &lt;x&gt; from REGA
                        <br />&nbsp;&nbsp;0101 &lt;x&gt; -- MUL REG by value at  &lt;x&gt;
                        <br />&nbsp;&nbsp;0110 &lt;x&gt; -- DIV REGA by value at  &lt;x&gt;
                        <br />&nbsp;&nbsp;1000 &lt;x&gt; -- PRINT &lt;x&gt; to Monitor
                        <br />&nbsp;&nbsp;1001 &lt;x&gt; -- INPUT keyboard to  &lt;x&gt;
                        <br />
                        </font>
		      </div>
		    </td>
		  </tr>
                 </div> <!-- end of boxes -->
		</table> <!-- end of RAM & CPU table -->
              </td>
	    </tr>
            <tr>
              <td>
               <button type="button" id="reset" onclick="reset()">Reset</button>
               <button type="button" id="fetch" onclick="fetchNextInstruction()" disabled>Fetch</button>
               <button type="button" id="exec" onclick="executeCurrentInstruction()" disabled>Execute</button>
               <button type="button" id="run" onclick="fetchExecute()" disabled>Run</button>
               <a target="_blank" href="https://docs.google.com/document/d/1_b0sq3gXLB0GZSpjKRX2qjUOvaMxsiHOLhmY1HOoclo"><button type="button" style="float:right">Help</button></a>
             </td>
            </tr>
	  </table> <!-- end of computer table -->
	</td>
      </tr>
    </table>  <!-- end of main container -->
  </body>
</html>
